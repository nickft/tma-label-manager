{% extends "web/layouts/app.html" %}

{% load crispy_forms_tags %}

{% block content %}
<main class="container">

    <div class="parent-player">
        <form class="training-form" action="/createTraining" method="post">
            {% csrf_token %}
            {% if training and not training.has_finished %}
            <div>Training in progress</div>
            {% else %}
            <table>
                {{ form | crispy }}
            </table>
            <button type="submit" class="btn btn-primary" value="Submit">Start Training</button>
            {% endif %}
        </form>

        <div id="1" class="twitch-player" />
    </div>
</main>

<!-- <div id="statistics">
        <h1 id="title">Realtime statistics</h1>
        <p id="timestamp"></p>
        <p id="quality"></p>
        <h2 id="videoid"></h2>

        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Metric</td>
                    <th>Value</td>
                    <th>Description</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Backend Version </th>
                    <td id="backend_version"></td>
                    <td>The version of the Twitch video player backend.</td>
                </tr>
                <tr>
                    <th>Buffer size</th>
                    <td id="buffer_size"></td>
                    <td>The size of the video buffer in seconds.</td>
                </tr>
                <tr>
                    <th>Codecs</th>
                    <td id="codecs"></td>
                    <td>Codecs currently in use, comma-separated (video,audio).</td>
                </tr>
                <tr>
                    <th>Display Resolution</th>
                    <td id="display_resolution"></td>
                    <td>The current size of the video player element (eg. 850x480).</td>
                </tr>
                <tr>
                    <th>FPS</th>
                    <td id="fps"></td>
                    <td>The video playback rate in frames per second. Not available on all browsers.</td>
                </tr>
                <tr>
                    <th>Playback Rate</th>
                    <td id="rate"></td>
                    <td>The playback bitrate in Kbps.</td>
                </tr>
                <tr>
                    <th>Skipped Frames</th>
                    <td id="skipped_frames"></td>
                    <td>The number of dropped frames.</td>
                </tr>
                <tr>
                    <th>Video Resolution</th>
                    <td id="video_resolution"></td>
                    <td>The native resolution of the current video (eg. 640x480).</td>
                </tr>
                <tr>
                    <th>PAUSED Counter</th>
                    <td id="paused_counter"></td>
                    <td>Player is paused. Buffering and seeking is not considered paused.</td>
                </tr>
                <tr>
                    <th>PLAY Counter</th>
                    <td id="play_counter"></td>
                    <td>Player just unpaused, will either start video playback or start buffering.</td>
                </tr>
            </tbody>
        </table>
    </div> -->


<script src="https://player.twitch.tv/js/embed/v1.js"></script>

<script type="text/javascript">

    // 1 second -> 1000 milliseconds
    const STATISTICS_FREQUENCY_IN_MILLIS = 5000;

    var pausedCounter = 0;
    var playCounter = 0;

    function countPauseEvents() {
        console.log("PAUSE")
        pausedCounter++;
    }

    function countPlayEvents() {
        console.log("Play")
        playCounter++;
    }

    var options = {
        width: "100%",
        height: "100%",
        video: "1171206001",
        autoplay: true,
    };
    var player = new Twitch.Player("1", options);
    player.setVolume(0.5);

    player.addEventListener(Twitch.Player.PAUSE, countPauseEvents);
    player.addEventListener(Twitch.Player.PLAY, countPlayEvents);


    window.setInterval(function () {

        document.getElementById("videoid").innerHTML = "<h2>Video Id: " + player.getVideo() + "</h2>"

        document.getElementById("timestamp").innerHTML = "Time (in seconds): " + player.getCurrentTime().toFixed()
        document.getElementById("quality").innerHTML = "Quality: " + player.getQuality() + " (Available Qualities are " + player.getQualities().map(q => q.name) + ")"

        console.log(player.getQualities());
        var playbackStats = player.getPlaybackStats();
        console.log(playbackStats);

        document.getElementById("backend_version").innerHTML = playbackStats.backendVersion
        document.getElementById("buffer_size").innerHTML = playbackStats.bufferSize
        document.getElementById("codecs").innerHTML = playbackStats.codecs
        document.getElementById("display_resolution").innerHTML = playbackStats.displayResolution
        document.getElementById("fps").innerHTML = playbackStats.fps
        document.getElementById("rate").innerHTML = playbackStats.playbackRate
        document.getElementById("skipped_frames").innerHTML = playbackStats.skippedFrames
        document.getElementById("video_resolution").innerHTML = playbackStats.videoResolution

        document.getElementById("paused_counter").innerHTML = pausedCounter
        document.getElementById("play_counter").innerHTML = playCounter


    }, STATISTICS_FREQUENCY_IN_MILLIS);
</script>

{% endblock content %}